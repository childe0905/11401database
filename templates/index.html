<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>ğŸ” ç¾é£Ÿè¨‚å–®ç³»çµ±</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
  <h1>ğŸŸ ç¾é£Ÿè¨‚å–®ç³»çµ±</h1>

  <!-- æ–°å¢è¨‚å–®è¡¨å–® -->
  <h2>ğŸ“ æ–°å¢è¨‚å–®</h2>
  <form method="POST">
    <label>å®¢äººå§“åï¼š</label><br>
    <input type="text" name="customer" required><br><br>

    <label>é¤é»åç¨±ï¼š</label><br>
    <select name="item" id="itemSelect" required>
      {% for m in menu %}
      <option value="{{ m.id }}" data-price="{{ m.price }}">{{ m.name }}</option>
      {% endfor %}
    </select>
    <span id="priceDisplay"></span>
    <br><br>

    <label>æ•¸é‡ï¼š</label><br>
    <input type="number" name="quantity" id="quantityInput" min="1" required>
    <span id="subtotalDisplay"></span>
    <br><br>

    <button type="submit">é€å‡ºè¨‚å–®</button>
  </form>

  <hr>

  <!-- è¨‚å–®ç´€éŒ„è¡¨æ ¼ -->
  <h2>ğŸ“‹ è¨‚å–®ç´€éŒ„</h2>

  <table border="1" cellpadding="8">
    <tr>
      <th>ID</th>
      <th>å®¢äºº</th>
      <th>é¤é»</th>
      <th>æ•¸é‡</th>
      <th>ç¸½é‡‘é¡</th>
      <th>æ™‚é–“</th>
      <th>æ“ä½œ</th>
    </tr>
    {% for order in orders %}
    <tr>
      <td>{{ order.id }}</td>
      <td>{{ order.customer }}</td>
      <td>{{ order.item }}</td>
      <td>{{ order.quantity }}</td>
      <td>{{ order.price }}</td>
      <td>{{ order.created_at }}</td>
      <td>
        <a href="{{ url_for('edit', order_id=order.id) }}">âœï¸ ä¿®æ”¹</a> |
        <a href="{{ url_for('delete', order_id=order.id) }}">ğŸ—‘ åˆªé™¤</a>
      </td>
    </tr>
    {% endfor %}

    <!-- ç¸½ç‡Ÿæ”¶ -->
    <tr>
      <td colspan="4" style="text-align:right"><b>ç¸½ç‡Ÿæ”¶</b></td>
      <td colspan="3"><b>{{ total if total else 0 }} å…ƒ</b></td>
    </tr>
  </table>

  <!-- JavaScript -->
  <script>
    // å¾å¾Œç«¯ menu å‚³é€²ä¾†ç”Ÿæˆåƒ¹æ ¼è¡¨
    const prices = {
      {% for m in menu %}
        "{{ m.id }}": {{ m.price }},
      {% endfor %}
    };

    const select = document.getElementById("itemSelect");
    const priceDisplay = document.getElementById("priceDisplay");
    const quantityInput = document.getElementById("quantityInput");
    const subtotalDisplay = document.getElementById("subtotalDisplay");

    function updateDisplay() {
      const itemId = select.value;
      const price = prices[itemId];
      priceDisplay.textContent = "åƒ¹æ ¼ï¼š" + price + " å…ƒ";

      const quantity = parseInt(quantityInput.value) || 0;
      subtotalDisplay.textContent = quantity > 0 ? "å°è¨ˆï¼š" + (price * quantity) + " å…ƒ" : "";
    }

    select.addEventListener("change", updateDisplay);
    quantityInput.addEventListener("input", updateDisplay);

    updateDisplay(); // åˆå§‹åŒ–é¡¯ç¤º
  </script>
</body>
</html>